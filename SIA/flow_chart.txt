┌─────────────────────────────┐
│  Load NetCDF Data           │
│  - topography (Z_topo)      │
│  - observed thickness       │
└────────────┬────────────────┘
             │
                      ▼
┌─────────────────────────────┐
│  Initialize Parameters      │
│  - Ice physics (ρ, g, fd)   │
│  - SMB (grad_b, b_max)      │
│  - Grid (dx, dy, Lx, Ly)    │
│  - Initial Z_ELA (trainable)│
└────────────┬────────────────┘
             │
                       ▼
┌─────────────────────────────┐
│  Glacier Dynamics Model     │
│  (solve_glacier_dynamics)  │
│                             │
│  For each timestep:         │
│  - Compute slopes (Sx, Sy)  │
│  - Calculate diffusivity D  │
│  - Fluxes and dH/dt         │
│  - SMB update               │
│  - Update ice thickness     │
└────────────┬────────────────┘
             │
                      ▼
┌─────────────────────────────┐
│  Inversion Function         │
│  (checkpointed_inversion_  │
│   _extent)                  │
│                             │
│  - Run forward model        │
│  - Create glacier masks     │
│  - Compute IoU loss         │
│  - Add smoothness regular.  │
└────────────┬────────────────┘
             │
                      ▼
┌─────────────────────────────┐
│  Optimization Loop          │
│  (Adam on Z_ELA)            │
│                             │
│  For each iteration:        │
│  - Adjust learning rate     │
│  - Compute loss & grad      │
│  - Backprop & update Z_ELA  │
│  - Track loss & gradients   │
└────────────┬────────────────┘
             │
                      ▼
┌─────────────────────────────┐
│  Output                     │
│  - Optimized Z_ELA          │
│  - Simulated thickness      │
│  - GPU memory usage         │
└─────────────────────────────┘

